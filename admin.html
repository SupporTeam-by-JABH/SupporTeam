<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin SupportTeam</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:#111;
  color:white;
  padding:20px;
}

h1{text-align:center;}

input{
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:10px;
  border:none;
  font-size:16px;
}

button{
  padding:12px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
  margin-top:5px;
}

.btn-main{background:#20c997;color:black;width:100%;}
.btn-edit{background:#ffc107;color:black;}
.btn-delete{background:#dc3545;color:white;}
.btn-logout{background:#6c757d;color:white;width:100%;margin-top:10px;}

.card{
  background:#1e1e1e;
  padding:15px;
  margin-top:15px;
  border-radius:15px;
}

.status-guide{
  background:#222;
  padding:15px;
  border-radius:15px;
  margin-top:20px;
}
</style>
</head>

<body>

<h1>Panel Administrador</h1>

<input type="text" id="folio" placeholder="Folio">
<input type="text" id="modelo" placeholder="Modelo">
<input type="text" id="estatus" placeholder="Estatus">
<input type="text" id="fecha" placeholder="Fecha estimada">

<button class="btn-main" onclick="guardar()">Guardar / Actualizar</button>
<button class="btn-logout" onclick="cerrarSesion()">Cerrar sesión</button>

<div class="status-guide">
<h3>Guía de Estatus</h3>
<ul>
<li>En espera de refacción</li>
<li>En proceso de reparación</li>
<li>Demora consulte a su técnico</li>
<li>Últimos retoques</li>
<li>Éxito / Reparado / Listo</li>
</ul>
</div>

<div id="lista"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_AUTH_DOMAIN",
  projectId: "TU_PROJECT_ID",
  storageBucket: "TU_STORAGE",
  messagingSenderId: "TU_MSG_ID",
  appId: "TU_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const contraseña="1234";
let acceso=prompt("Ingrese contraseña:");
if(acceso!==contraseña){
  document.body.innerHTML="Acceso denegado";
}

let editandoId=null;

window.guardar=async function(){
  const folio=folioInput.value.trim();
  const modelo=modeloInput.value.trim();
  const estatus=estatusInput.value.trim();
  const fecha=fechaInput.value.trim();

  if(editandoId){
    await updateDoc(doc(db,"reparaciones",editandoId),{folio,modelo,estatus,fecha});
    editandoId=null;
  }else{
    await addDoc(collection(db,"reparaciones"),{folio,modelo,estatus,fecha});
  }
  limpiar();
  mostrar();
}

window.editar=function(id,folio,modelo,estatus,fecha){
  editandoId=id;
  folioInput.value=folio;
  modeloInput.value=modelo;
  estatusInput.value=estatus;
  fechaInput.value=fecha;
}

window.eliminar=async function(id){
  await deleteDoc(doc(db,"reparaciones",id));
  mostrar();
}

function limpiar(){
  folioInput.value="";
  modeloInput.value="";
  estatusInput.value="";
  fechaInput.value="";
}

window.cerrarSesion=function(){
  location.reload();
}

async function mostrar(){
  lista.innerHTML="";
  const querySnapshot=await getDocs(collection(db,"reparaciones"));
  querySnapshot.forEach((docSnap)=>{
    const data=docSnap.data();
    lista.innerHTML+=`
      <div class="card">
        <strong>${data.folio}</strong> - ${data.modelo}<br>
        ${data.estatus} | ${data.fecha}<br><br>
        <button class="btn-edit" onclick="editar('${docSnap.id}','${data.folio}','${data.modelo}','${data.estatus}','${data.fecha}')">Editar</button>
        <button class="btn-delete" onclick="eliminar('${docSnap.id}')">Eliminar</button>
      </div>`;
  });
}

mostrar();
</script>

</body>
</html>
